# Bore 跳板机代理使用指南

在无法直接连接外网 `bore server`（如 `tyoo.fun`）的内网环境下，你可以利用新增的 `--proxy` 功能，通过 SSH 跳板机建立隧道进行中转。

## 场景描述
- **内网机器**：运行 `bore` 的机器，无法访问互联网。
- **跳板机**：一台既能被内网机器 SSH 访问，又能访问互联网的机器。
- **Bore Server**：位于公网的服务器（默认 `tyoo.fun`）。

---

## 快速开始

### 第一步：在内网机器上建立 SSH 隧道
使用 SSH 的动态端口转发功能（Dynamic Forwarding），将跳板机变成一个本地的 SOCKS5 代理。

```bash
# -D 1080: 在本地启动 SOCKS5 代理监听 1080 端口
# -N: 不执行远程命令（仅用于转发）
# -f: 后台运行
ssh -D 1080 -N -f user@跳板机IP
```

### 第二步：启动 Bore 并指定上游代理

现在，让 `bore` 通过刚才建立的本地隧道出网：

#### 1. 启动代理服务器模式 (Proxy Mode)
将本机的出口网络通过跳板机转发到公网，并在公网服务器上开启代理端口：
```bash
./bore proxy --proxy 127.0.0.1:1080
```

#### 2. 映射本地端口 (Local Forwarding)
将本地的 8000 端口通过跳板机映射到公网：
```bash
./bore local 8000 --proxy 127.0.0.1:1080
```

---

## 参数说明

| 参数 | 环境变量 | 说明 | 示例 |
| :--- | :--- | :--- | :--- |
| `--proxy` | `BORE_UPSTREAM_PROXY` | 上游 SOCKS5 代理地址 | `127.0.0.1:1080` |
| `--to` | `BORE_SERVER` | 远程服务器地址 | 默认 `tyoo.fun` |

---

## 高级用法：使用环境变量
为了简化输入，你可以将代理地址直接写入环境变量：

```bash
export BORE_UPSTREAM_PROXY=127.0.0.1:1080
# 之后直接运行即可，无需每次带参数
./bore proxy
```

## 常见问题排查
1. **连接超时**：请检查 SSH 隧道是否还在运行（`ps aux | grep ssh`）。
2. **代理失败**：确保跳板机能够解析并访问 `tyoo.fun`。
3. **认证错误**：如果 `bore server` 设置了 secret，请确保加上 `-s <SECRET>` 参数。
